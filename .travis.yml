language: generic

sudo: required

# tell Travis that we need a docker installed
services:
  - docker
# the project name after the docker id is the repo name from Github
# but the tag name is convention anyway, it could be anything
before_install:
  # the reason we are using the Dockerfile.dev is that we have the test image set up inside this file
  - docker build -t aichichangnandos/docker-playground -f Dockerfile.dev .

script:
  - docker run -e CI=true aichichangnandos/docker-playground npm run test

deploy:
  priovider: elasticbeanstalk
  region: "us-east-1"
  name: "docker-playground"
  env: "dockerPlayground-env"
  # AWS S3 bucket is automatically generated by elasticbeanstalk
  bucket_name: "elasticbeanstalk-us-east-1-704623156014"
  # bucket_path is the same as the "name"
  bucket_path:  "docker-playground"
  # only redeploy when master is updated, but not any feature branches
  on:
    branch: master

  # We've set up our keys on Travis CI, so it's not exposed on Guithub
  access_key_id: $AWS_ACCESS_KEY
  secret_access_key: "$AWS_SECRET_KEY"